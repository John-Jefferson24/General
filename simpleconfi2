## FIXED DIAGNOSTIC REQUEST LOGGING ##

# Load only necessary modules
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_http_module modules/mod_proxy_http.so
LoadModule headers_module modules/mod_headers.so
LoadModule setenvif_module modules/mod_setenvif.so

# Maximum logging
LogLevel debug
ErrorLog /var/log/httpd/proxy_error.log
CustomLog /var/log/httpd/proxy_access.log combined

# Capture Content-Type header for debugging
SetEnvIf Content-Type "(.*)" CONTENT_TYPE=$1

# Global settings
ProxyRequests Off
ProxyPreserveHost On

# Basic function - proxy everything with headers
<Location "/">
    # Set response headers with request details
    Header always set X-Request-Method "%{REQUEST_METHOD}s"
    Header always set X-Request-URI "%{REQUEST_URI}s"
    Header always set X-Content-Type "%{CONTENT_TYPE}e" env=CONTENT_TYPE
    
    # Basic proxy function
    ProxyPass "http://triton1.internal/v1/chat/completions"
    ProxyPassReverse "http://triton1.internal/v1/chat/completions"
</Location>

# CORS headers
Header always set Access-Control-Allow-Origin "*"
Header always set Access-Control-Allow-Headers "Content-Type, Authorization"
Header always set Access-Control-Allow-Methods "POST, GET, OPTIONS"
Header always set Cache-Control "no-store"
